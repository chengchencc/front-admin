import{a as L,ac as B,aH as j,H as n,aI as A,_ as x,N as k,U,O as M,aJ as H,ai as G,p as I,S as b,Q as R,R as J}from"./index.0afb6b1a.js";import{w as S}from"./warning.ca82f8e0.js";import{c as Q,a as V,d as C,e as P,p as E,b as D,f as W,h as $,i as T,j as m,k as q,w as z,g as F,m as X,l as Y}from"./util.5b402eb8.js";function Z(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e={};return l.forEach(function(t){e[t]={handler:function(){this.needSyncKeys[t]=!0},flush:"sync"}}),e}var ee=L({name:"Tree",mixins:[B],provide:function(){return{vcTree:this}},inheritAttrs:!1,props:j({prefixCls:n.string,tabindex:n.oneOfType([n.string,n.number]),children:n.any,treeData:n.array,showLine:n.looseBool,showIcon:n.looseBool,icon:n.oneOfType([n.object,n.func]),focusable:n.looseBool,selectable:n.looseBool,disabled:n.looseBool,multiple:n.looseBool,checkable:A(n.oneOfType([n.object,n.looseBool])),checkStrictly:n.looseBool,draggable:n.looseBool,defaultExpandParent:n.looseBool,autoExpandParent:n.looseBool,defaultExpandAll:n.looseBool,defaultExpandedKeys:n.array,expandedKeys:n.array,defaultCheckedKeys:n.array,checkedKeys:n.oneOfType([n.array,n.object]),defaultSelectedKeys:n.array,selectedKeys:n.array,loadData:n.func,loadedKeys:n.array,filterTreeNode:n.func,openTransitionName:n.string,openAnimation:n.oneOfType([n.string,n.object]),switcherIcon:n.any,__propsSymbol__:n.any},{prefixCls:"rc-tree",showLine:!1,showIcon:!0,selectable:!0,multiple:!1,checkable:!1,disabled:!1,checkStrictly:!1,draggable:!1,defaultExpandParent:!0,autoExpandParent:!1,defaultExpandAll:!1,defaultExpandedKeys:[],defaultCheckedKeys:[],defaultSelectedKeys:[]}),data:function(){S(this.$props.__propsSymbol__),S(this.$props.children),this.needSyncKeys={},this.domTreeNodes={};var e={_posEntities:new Map,_keyEntities:new Map,_expandedKeys:[],_selectedKeys:[],_checkedKeys:[],_halfCheckedKeys:[],_loadedKeys:[],_loadingKeys:[],_treeNode:[],_prevProps:null,_dragOverNodeKey:"",_dropPosition:null,_dragNodesKeys:[]};return x(x({},e),this.getDerivedState(k(this),e))},watch:x(x({},Z(["treeData","children","expandedKeys","autoExpandParent","selectedKeys","checkedKeys","loadedKeys"])),{__propsSymbol__:function(){this.setState(this.getDerivedState(k(this),this.$data)),this.needSyncKeys={}}}),methods:{getDerivedState:function(e,t){var a=t._prevProps,d={_prevProps:x({},e)},o=this;function s(p){return!a&&p in e||a&&o.needSyncKeys[p]}var r=null;if(s("treeData")?r=Q(e.treeData):s("children")&&(r=e.children),r){d._treeNode=r;var c=V(r);d._keyEntities=c.keyEntities}var y=d._keyEntities||t._keyEntities;if(s("expandedKeys")||a&&s("autoExpandParent")?d._expandedKeys=e.autoExpandParent||!a&&e.defaultExpandParent?C(e.expandedKeys,y):e.expandedKeys:!a&&e.defaultExpandAll?d._expandedKeys=U(y.keys()):!a&&e.defaultExpandedKeys&&(d._expandedKeys=e.autoExpandParent||e.defaultExpandParent?C(e.defaultExpandedKeys,y):e.defaultExpandedKeys),e.selectable&&(s("selectedKeys")?d._selectedKeys=P(e.selectedKeys,e):!a&&e.defaultSelectedKeys&&(d._selectedKeys=P(e.defaultSelectedKeys,e))),e.checkable){var i;if(s("checkedKeys")?i=E(e.checkedKeys)||{}:!a&&e.defaultCheckedKeys?i=E(e.defaultCheckedKeys)||{}:r&&(i=E(e.checkedKeys)||{checkedKeys:t._checkedKeys,halfCheckedKeys:t._halfCheckedKeys}),i){var u=i,h=u.checkedKeys,_=h===void 0?[]:h,K=u.halfCheckedKeys,N=K===void 0?[]:K;if(!e.checkStrictly){var v=D(_,!0,y);_=v.checkedKeys,N=v.halfCheckedKeys}d._checkedKeys=_,d._halfCheckedKeys=N}}return s("loadedKeys")&&(d._loadedKeys=e.loadedKeys),d},onNodeDragStart:function(e,t){var a=this.$data._expandedKeys,d=t.eventKey,o=M(t);this.dragNode=t,this.setState({_dragNodesKeys:W(typeof o=="function"?o():o,t),_expandedKeys:$(a,d)}),this.__emit("dragstart",{event:e,node:t})},onNodeDragEnter:function(e,t){var a=this,d=this.$data._expandedKeys,o=t.pos,s=t.eventKey;if(!(!this.dragNode||!t.selectHandle)){var r=T(e,t);if(this.dragNode.eventKey===s&&r===0){this.setState({_dragOverNodeKey:"",_dropPosition:null});return}setTimeout(function(){a.setState({_dragOverNodeKey:s,_dropPosition:r}),a.delayedDragEnterLogic||(a.delayedDragEnterLogic={}),Object.keys(a.delayedDragEnterLogic).forEach(function(c){clearTimeout(a.delayedDragEnterLogic[c])}),a.delayedDragEnterLogic[o]=setTimeout(function(){var c=m(d,s);H(a,"expandedKeys")||a.setState({_expandedKeys:c}),a.__emit("dragenter",{event:e,node:t,expandedKeys:c})},400)},0)}},onNodeDragOver:function(e,t){var a=t.eventKey,d=this.$data,o=d._dragOverNodeKey,s=d._dropPosition;if(this.dragNode&&a===o&&t.selectHandle){var r=T(e,t);if(r===s)return;this.setState({_dropPosition:r})}this.__emit("dragover",{event:e,node:t})},onNodeDragLeave:function(e,t){this.setState({_dragOverNodeKey:""}),this.__emit("dragleave",{event:e,node:t})},onNodeDragEnd:function(e,t){this.setState({_dragOverNodeKey:""}),this.__emit("dragend",{event:e,node:t}),this.dragNode=null},onNodeDrop:function(e,t){var a=this.$data,d=a._dragNodesKeys,o=d===void 0?[]:d,s=a._dropPosition,r=t.eventKey,c=t.pos;if(this.setState({_dragOverNodeKey:""}),o.indexOf(r)!==-1){S();return}var y=q(c),i={event:e,node:t,dragNode:this.dragNode,dragNodesKeys:o.slice(),dropPosition:s+Number(y[y.length-1]),dropToGap:!1};s!==0&&(i.dropToGap=!0),this.__emit("drop",i),this.dragNode=null},onNodeClick:function(e,t){this.__emit("click",e,t)},onNodeDoubleClick:function(e,t){this.__emit("dblclick",e,t)},onNodeSelect:function(e,t){var a=this.$data._selectedKeys,d=this.$data._keyEntities,o=this.$props.multiple,s=k(t),r=s.selected,c=s.eventKey,y=!r;y?o?a=m(a,c):a=[c]:a=$(a,c);var i=a.map(function(h){var _=d.get(h);return _?_.node:null}).filter(function(h){return h});this.setUncontrolledState({_selectedKeys:a});var u={event:"select",selected:y,node:t,selectedNodes:i,nativeEvent:e};this.__emit("select",a,u)},onNodeCheck:function(e,t,a){var d=this.$data,o=d._keyEntities,s=d._checkedKeys,r=d._halfCheckedKeys,c=this.$props.checkStrictly,y=k(t),i=y.eventKey,u,h={event:"check",node:t,checked:a,nativeEvent:e};if(c){var _=a?m(s,i):$(s,i),K=$(r,i);u={checked:_,halfChecked:K},h.checkedNodes=_.map(function(g){return o.get(g)}).filter(function(g){return g}).map(function(g){return g.node}),this.setUncontrolledState({_checkedKeys:_})}else{var N=D([i],a,o,{checkedKeys:s,halfCheckedKeys:r}),v=N.checkedKeys,p=N.halfCheckedKeys;u=v,h.checkedNodes=[],h.checkedNodesPositions=[],h.halfCheckedKeys=p,v.forEach(function(g){var f=o.get(g);if(!!f){var O=f.node,w=f.pos;h.checkedNodes.push(O),h.checkedNodesPositions.push({node:O,pos:w})}}),this.setUncontrolledState({_checkedKeys:v,_halfCheckedKeys:p})}this.__emit("check",u,h)},onNodeLoad:function(e){var t=this;return new Promise(function(a){t.setState(function(d){var o=d._loadedKeys,s=o===void 0?[]:o,r=d._loadingKeys,c=r===void 0?[]:r,y=t.$props.loadData,i=k(e),u=i.eventKey;if(!y||s.indexOf(u)!==-1||c.indexOf(u)!==-1)return{};var h=y(e);return h.then(function(){var _=t.$data,K=_._loadedKeys,N=_._loadingKeys,v=m(K,u),p=$(N,u);t.__emit("load",v,{event:"load",node:e}),t.setUncontrolledState({_loadedKeys:v}),t.setState({_loadingKeys:p}),a()}),{_loadingKeys:m(c,u)}})})},onNodeExpand:function(e,t){var a=this,d=this.$data._expandedKeys,o=this.$props.loadData,s=k(t),r=s.eventKey,c=s.expanded;d.indexOf(r);var y=!c;if(S(),y?d=m(d,r):d=$(d,r),this.setUncontrolledState({_expandedKeys:d}),this.__emit("expand",d,{node:t,expanded:y,nativeEvent:e}),y&&o){var i=this.onNodeLoad(t);return i?i.then(function(){a.setUncontrolledState({_expandedKeys:d})}):null}return null},onNodeMouseEnter:function(e,t){this.__emit("mouseenter",{event:e,node:t})},onNodeMouseLeave:function(e,t){this.__emit("mouseleave",{event:e,node:t})},onNodeContextMenu:function(e,t){e.preventDefault(),this.__emit("rightClick",{event:e,node:t})},setUncontrolledState:function(e){var t=!1,a={},d=k(this);Object.keys(e).forEach(function(o){o.replace("_","")in d||(t=!0,a[o]=e[o])}),t&&this.setState(a)},registerTreeNode:function(e,t){t?this.domTreeNodes[e]=t:delete this.domTreeNodes[e]},isKeyChecked:function(e){var t=this.$data._checkedKeys,a=t===void 0?[]:t;return a.indexOf(e)!==-1},renderTreeNode:function(e,t){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,d=this.$data,o=d._keyEntities,s=d._expandedKeys,r=s===void 0?[]:s,c=d._selectedKeys,y=c===void 0?[]:c,i=d._halfCheckedKeys,u=i===void 0?[]:i,h=d._loadedKeys,_=h===void 0?[]:h,K=d._loadingKeys,N=K===void 0?[]:K,v=d._dragOverNodeKey,p=d._dropPosition,g=Y(a,t),f=e.key;return!f&&f==null&&(f=g),o.get(f)?G(e,{eventKey:f,expanded:r.indexOf(f)!==-1,selected:y.indexOf(f)!==-1,loaded:_.indexOf(f)!==-1,loading:N.indexOf(f)!==-1,checked:this.isKeyChecked(f),halfChecked:u.indexOf(f)!==-1,pos:g,dragOver:v===f&&p===0,dragOverGapTop:v===f&&p===-1,dragOverGapBottom:v===f&&p===1,key:f}):(z(),null)}},render:function(){var e=this,t=this.$data._treeNode,a=this.$props,d=a.prefixCls,o=a.focusable,s=a.showLine,r=a.tabindex,c=r===void 0?0:r,y=F(x(x({},this.$props),this.$attrs)),i=this.$attrs,u=i.class,h=i.style;return I("ul",b(b({},y),{},{class:R(d,u,J({},"".concat(d,"-show-line"),s)),style:h,role:"tree",unselectable:"on",tabindex:o?c:null}),[X(t,function(_,K){return e.renderTreeNode(_,K)})])}}),ne=ee;export{ne as T};
